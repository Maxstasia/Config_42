# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: mstasiak <mstasiak@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/02/25 13:05:47 by mstasiak          #+#    #+#              #
#    Updated: 2025/02/25 14:29:18 by mstasiak         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

VENV_NAME = $(HOME)/.venv
VENV_BIN = $(VENV_NAME)/bin
PIP = $(VENV_BIN)/pip
PYTHON = $(VENV_BIN)/python
REQUIREMENTS = requirements.txt
SCRIPT = screen_saver.py

# Par dÃ©faut, exÃ©cuter le bot
all: run

# CrÃ©ation de l'environnement virtuel
$(VENV_NAME)/bin/activate: $(REQUIREMENTS)
	@echo "CrÃ©ation de l'environnement virtuel..."
	@python3 -m venv $(VENV_NAME)
	@$(PYTHON) -m pip install --upgrade pip setuptools wheel
	@$(PIP) install -r $(REQUIREMENTS)
	@echo "âœ… Environnement virtuel crÃ©Ã© et dÃ©pendances installÃ©es."

# Installer les dÃ©pendances
install: $(VENV_NAME)/bin/activate
	@echo "âœ… Toutes les dÃ©pendances sont installÃ©es."

# Lancer le bot
run: install
	@echo "ðŸš€ Lancement du programme..."
	@$(PYTHON) $(SCRIPT)

# DÃ©sinstaller tout
uninstall:
	@echo "ðŸ—‘ Suppression de l'environnement virtuel..."
	@rm -rf $(VENV_NAME)
	@echo "âœ… Environnement virtuel supprimÃ©."

# VÃ©rifier si les dÃ©pendances sont installÃ©es
check_deps:
	@echo "ðŸ” VÃ©rification des dÃ©pendances..."
	@$(PIP) freeze > current_requirements.txt
	@diff current_requirements.txt $(REQUIREMENTS) > diff.txt; \
	if [ -s diff.txt ]; then \
		echo "âš ï¸ Des dÃ©pendances manquent ou sont obsolÃ¨tes."; \
		echo "âž¡ï¸ Vous pouvez utiliser 'make install' pour corriger."; \
	else \
		echo "âœ… Toutes les dÃ©pendances sont installÃ©es et Ã  jour."; \
	fi

# CrÃ©er un fichier requirements.txt si inexistant
$(REQUIREMENTS):
	@echo "tk" > $(REQUIREMENTS)
	@echo "ðŸ“œ Fichier requirements.txt gÃ©nÃ©rÃ©."
